!function(e){function t(e){var t=require("./"+e+"."+r+".hot-update.js");!function(e,t){if(!b[e]||!O[e])return;for(var o in O[e]=!1,t)Object.prototype.hasOwnProperty.call(t,o)&&(y[o]=t[o]);0==--g&&0===v&&P()}(t.id,t.modules)}var o,n=!0,r="d6127a8b94da5858bacc",i={},s=[],a=[];function d(e){var t=A[e];if(!t)return M;var n=function(n){return t.hot.active?(A[n]?-1===A[n].parents.indexOf(e)&&A[n].parents.push(e):(s=[e],o=n),-1===t.children.indexOf(n)&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),s=[]),M(n)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return M[e]},set:function(t){M[e]=t}}};for(var i in M)Object.prototype.hasOwnProperty.call(M,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(n,i,r(i));return n.e=function(e){return"ready"===l&&p("prepare"),v++,M.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===l&&(m[e]||w(e),0===v&&0===g&&P())}},n.t=function(e,t){return 1&t&&(e=n(e)),M.t(e,-2&t)},n}function c(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:o!==e,active:!0,accept:function(e,o){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._acceptedDependencies[e[n]]=o||function(){};else t._acceptedDependencies[e]=o||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var o=0;o<e.length;o++)t._declinedDependencies[e[o]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var o=t._disposeHandlers.indexOf(e);o>=0&&t._disposeHandlers.splice(o,1)},check:E,apply:R,status:function(e){if(!e)return l;u.push(e)},addStatusHandler:function(e){u.push(e)},removeStatusHandler:function(e){var t=u.indexOf(e);t>=0&&u.splice(t,1)},data:i[e]};return o=void 0,t}var u=[],l="idle";function p(e){l=e;for(var t=0;t<u.length;t++)u[t].call(null,e)}var f,y,h,g=0,v=0,m={},O={},b={};function _(e){return+e+""===e?+e:e}function E(e){if("idle"!==l)throw new Error("check() is only allowed in idle status");return n=e,p("check"),function(){try{var e=require("./"+r+".hot-update.json")}catch(e){return Promise.resolve()}return Promise.resolve(e)}().then((function(e){if(!e)return p("idle"),null;O={},m={},b=e.c,h=e.h,p("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));y={};return w(0),"prepare"===l&&0===v&&0===g&&P(),t}))}function w(e){b[e]?(O[e]=!0,g++,t(e)):m[e]=!0}function P(){p("ready");var e=f;if(f=null,e)if(n)Promise.resolve().then((function(){return R(n)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var o in y)Object.prototype.hasOwnProperty.call(y,o)&&t.push(_(o));e.resolve(t)}}function R(t){if("ready"!==l)throw new Error("apply() is only allowed in ready status");var o,n,a,d,c;function u(e){for(var t=[e],o={},n=t.map((function(e){return{chain:[e],id:e}}));n.length>0;){var r=n.pop(),i=r.id,s=r.chain;if((d=A[i])&&!d.hot._selfAccepted){if(d.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:i};if(d.hot._main)return{type:"unaccepted",chain:s,moduleId:i};for(var a=0;a<d.parents.length;a++){var c=d.parents[a],u=A[c];if(u){if(u.hot._declinedDependencies[i])return{type:"declined",chain:s.concat([c]),moduleId:i,parentId:c};-1===t.indexOf(c)&&(u.hot._acceptedDependencies[i]?(o[c]||(o[c]=[]),f(o[c],[i])):(delete o[c],t.push(c),n.push({chain:s.concat([c]),id:c})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:o}}function f(e,t){for(var o=0;o<t.length;o++){var n=t[o];-1===e.indexOf(n)&&e.push(n)}}t=t||{};var g={},v=[],m={},O=function(){console.warn("[HMR] unexpected require("+w.moduleId+") to disposed module")};for(var E in y)if(Object.prototype.hasOwnProperty.call(y,E)){var w;c=_(E);var P=!1,R=!1,C=!1,x="";switch((w=y[E]?u(c):{type:"disposed",moduleId:E}).chain&&(x="\nUpdate propagation: "+w.chain.join(" -> ")),w.type){case"self-declined":t.onDeclined&&t.onDeclined(w),t.ignoreDeclined||(P=new Error("Aborted because of self decline: "+w.moduleId+x));break;case"declined":t.onDeclined&&t.onDeclined(w),t.ignoreDeclined||(P=new Error("Aborted because of declined dependency: "+w.moduleId+" in "+w.parentId+x));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(w),t.ignoreUnaccepted||(P=new Error("Aborted because "+c+" is not accepted"+x));break;case"accepted":t.onAccepted&&t.onAccepted(w),R=!0;break;case"disposed":t.onDisposed&&t.onDisposed(w),C=!0;break;default:throw new Error("Unexception type "+w.type)}if(P)return p("abort"),Promise.reject(P);if(R)for(c in m[c]=y[c],f(v,w.outdatedModules),w.outdatedDependencies)Object.prototype.hasOwnProperty.call(w.outdatedDependencies,c)&&(g[c]||(g[c]=[]),f(g[c],w.outdatedDependencies[c]));C&&(f(v,[w.moduleId]),m[c]=O)}var j,U=[];for(n=0;n<v.length;n++)c=v[n],A[c]&&A[c].hot._selfAccepted&&m[c]!==O&&U.push({module:c,errorHandler:A[c].hot._selfAccepted});p("dispose"),Object.keys(b).forEach((function(e){!1===b[e]&&function(e){delete installedChunks[e]}(e)}));for(var S,D,I=v.slice();I.length>0;)if(c=I.pop(),d=A[c]){var L={},N=d.hot._disposeHandlers;for(a=0;a<N.length;a++)(o=N[a])(L);for(i[c]=L,d.hot.active=!1,delete A[c],delete g[c],a=0;a<d.children.length;a++){var k=A[d.children[a]];k&&((j=k.parents.indexOf(c))>=0&&k.parents.splice(j,1))}}for(c in g)if(Object.prototype.hasOwnProperty.call(g,c)&&(d=A[c]))for(D=g[c],a=0;a<D.length;a++)S=D[a],(j=d.children.indexOf(S))>=0&&d.children.splice(j,1);for(c in p("apply"),r=h,m)Object.prototype.hasOwnProperty.call(m,c)&&(e[c]=m[c]);var T=null;for(c in g)if(Object.prototype.hasOwnProperty.call(g,c)&&(d=A[c])){D=g[c];var q=[];for(n=0;n<D.length;n++)if(S=D[n],o=d.hot._acceptedDependencies[S]){if(-1!==q.indexOf(o))continue;q.push(o)}for(n=0;n<q.length;n++){o=q[n];try{o(D)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:c,dependencyId:D[n],error:e}),t.ignoreErrored||T||(T=e)}}}for(n=0;n<U.length;n++){var H=U[n];c=H.module,s=[c];try{M(c)}catch(e){if("function"==typeof H.errorHandler)try{H.errorHandler(e)}catch(o){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:c,error:o,originalError:e}),t.ignoreErrored||T||(T=o),T||(T=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:c,error:e}),t.ignoreErrored||T||(T=e)}}return T?(p("fail"),Promise.reject(T)):(p("idle"),new Promise((function(e){e(v)})))}var A={};function M(t){if(A[t])return A[t].exports;var o=A[t]={i:t,l:!1,exports:{},hot:c(t),parents:(a=s,s=[],a),children:[]};return e[t].call(o.exports,o,o.exports,d(t)),o.l=!0,o.exports}M.m=e,M.c=A,M.d=function(e,t,o){M.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},M.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},M.t=function(e,t){if(1&t&&(e=M(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(M.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)M.d(o,n,function(t){return e[t]}.bind(null,n));return o},M.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return M.d(t,"a",t),t},M.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},M.p="",M.h=function(){return r},d(17)(M.s=17)}([function(e,t){e.exports=require("typeorm")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o(24).config();t.NODE_ENV="production";const n=+process.env.PORT||4e3;t.PORT=n;const r=+process.env.RATE_LIMIT_MAX||100;t.RATE_LIMIT_MAX=r;const i=process.env.DOMAIN||"localhost";t.DOMAIN=i;const s=process.env.END_POINT||"graphql";t.END_POINT=s;const a=process.env.PRIMARY_COLOR||"#ad4c45";t.PRIMARY_COLOR=a;const d=process.env.MLAB_USER||"duchuy",c=process.env.MLAB_PASS||"123",u=process.env.MLAB_DATABASE||"blog";t.MLAB_DATABASE=u;const l=process.env.MLAB_URL||`mongodb+srv://${d}:${c}@cluster0-yyvtg.mongodb.net/test?retryWrites=true&w=majority`;t.MLAB_URL=l;const p=process.env.MONGO_DB||"duchuy";t.MONGO_DB=p;const f=process.env.SECRET_KEY_TOKEN||"duchuy";t.SECRET_KEY_TOKEN=f;const y=process.env.ACCESS_TOKEN||"access-token";t.ACCESS_TOKEN=y},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),n(o(30)),n(o(32)),n(o(33))},function(e,t){e.exports=require("@nestjs/common")},function(e,t){e.exports=require("@nestjs/graphql")},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=o(0),i=o(16),s=o(2);t.DashboardService=class{dashboardUpdated(e){return n(this,void 0,void 0,(function*(){const t=yield r.getMongoRepository(s.UserEntity).find({}),o=yield r.getMongoRepository(s.PostEntity).find({}),n={};t.map(e=>{n[e._id]=e});const a=o.reduce((e,t)=>(e[t.idCreator]?e[t.idCreator]++:e[t.idCreator]=1,e),{});let d,c=0;Object.keys(a).forEach(e=>{a[e]>=c&&(d=e),c=a[e]});const u=o.length>0?null==o?void 0:o.sort((e,t)=>(null==t?void 0:t.idLikes.length)-(null==e?void 0:e.idLikes.length))[0]:{},l=[i().startOf("days").valueOf(),i().valueOf()],p=[i().subtract(1,"days").startOf("days").valueOf(),i().subtract(1,"days").endOf("days").valueOf()],f=[i().subtract(2,"days").startOf("days").valueOf(),i().subtract(2,"days").endOf("days").valueOf()],y=[i().subtract(3,"days").startOf("days").valueOf(),i().subtract(3,"days").endOf("days").valueOf()],h=[i().subtract(4,"days").startOf("days").valueOf(),i().subtract(4,"days").endOf("days").valueOf()],g=[i().subtract(5,"days").startOf("days").valueOf(),i().subtract(5,"days").endOf("days").valueOf()],v=[i().subtract(6,"days").startOf("days").valueOf(),i().subtract(6,"days").endOf("days").valueOf()],m=[0,0,0,0,0,0,0];o.map(e=>{e.createdAt>=l[0]&&e.createdAt<=l[1]&&m[0]++,e.createdAt>=p[0]&&e.createdAt<=p[1]&&m[1]++,e.createdAt>=f[0]&&e.createdAt<=f[1]&&m[2]++,e.createdAt>=y[0]&&e.createdAt<=y[1]&&m[3]++,e.createdAt>=h[0]&&e.createdAt<=h[1]&&m[4]++,e.createdAt>=g[0]&&e.createdAt<=g[1]&&m[5]++,e.createdAt>=v[0]&&e.createdAt<=v[1]&&m[6]++}),e.publish("dashboardUpdated",{dashboardUpdated:{numberOfUsers:t.length,numberOfPosts:o.length,topUser:n[d],topPost:u,postsInWeek:m}})}))}}},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("class-transformer")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UNKNOWN="UNKNOWN",e.MALE="MALE",e.FEMALE="FEMALE"}(t.Gender||(t.Gender={})),function(e){e.SUPERADMIN="SUPERADMIN",e.ADMIN="ADMIN",e.MEMBER="MEMBER"}(t.Role||(t.Role={}));t.PostInput=class{};t.CommentInput=class{};t.CreateUserInput=class{};t.LoginRequest=class{};t.UpdateUserInput=class{};t.DashboardData=class{};t.IQuery=class{};t.ISubscription=class{};t.Comment=class{};t.Post=class{};t.IMutation=class{};t.User=class{};t.LoginResponse=class{}},function(e,t){e.exports=require("apollo-server-express")},function(e,t){e.exports=require("apollo-server-core")},function(e,t){var o="info";function n(){}function r(e){return"info"===o&&"info"===e||["info","warning"].indexOf(o)>=0&&"warning"===e||["info","warning","error"].indexOf(o)>=0&&"error"===e}function i(e){return function(t,o){r(t)&&e(o)}}e.exports=function(e,t){r(e)&&("info"===e?console.log(t):"warning"===e?console.warn(t):"error"===e&&console.error(t))};var s=console.group||n,a=console.groupCollapsed||n,d=console.groupEnd||n;e.exports.group=i(s),e.exports.groupCollapsed=i(a),e.exports.groupEnd=i(d),e.exports.setLogLevel=function(e){o=e},e.exports.formatError=function(e){var t=e.message,o=e.stack;return o?o.indexOf(t)<0?t+"\n"+o:o:t}},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),n(o(25)),n(o(27)),n(o(39)),n(o(40))},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("graphql")},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=o(38),i=o(0),s=o(10),a=o(2),d=o(1);t.generateToken=e=>n(void 0,void 0,void 0,(function*(){return yield r.sign({_id:e._id},d.SECRET_KEY_TOKEN)})),t.verifyToken=e=>n(void 0,void 0,void 0,(function*(){let t;return yield r.verify(e,d.SECRET_KEY_TOKEN,(e,o)=>n(void 0,void 0,void 0,(function*(){if(e)throw new s.AuthenticationError("Authentication token is invalid, please try again.");t=yield i.getMongoRepository(a.UserEntity).findOne({_id:o._id})}))),t}))},function(e,t){e.exports=require("moment")},function(e,t,o){o(18),e.exports=o(20)},function(e,t,o){(function(t){var n=+t.substr(1)||6e5,r=o(11);setInterval((function t(n){"idle"===e.hot.status()&&e.hot.check(!0).then((function(e){e?(o(19)(e,e),t(!0)):n&&r("info","[HMR] Update applied.")})).catch((function(t){var o=e.hot.status();["abort","fail"].indexOf(o)>=0?(r("warning","[HMR] Cannot apply update."),r("warning","[HMR] "+r.formatError(t)),r("warning","[HMR] You need to restart the application!")):r("warning","[HMR] Update failed: "+r.formatError(t))}))}),n)}).call(this,"?100")},function(e,t,o){e.exports=function(e,t){var n=e.filter((function(e){return t&&t.indexOf(e)<0})),r=o(11);(n.length>0&&(r("warning","[HMR] The following modules couldn't be hot updated: (They would need a full reload!)"),n.forEach((function(e){r("warning","[HMR]  - "+e)}))),t&&0!==t.length)?(r("info","[HMR] Updated modules:"),t.forEach((function(e){if("string"==typeof e&&-1!==e.indexOf("!")){var t=e.split("!");r.groupCollapsed("info","[HMR]  - "+t.pop()),r("info","[HMR]  - "+e),r.groupEnd("info")}else r("info","[HMR]  - "+e)})),t.every((function(e){return"number"==typeof e}))&&r("info","[HMR] Consider using the NamedModulesPlugin for module names.")):r("info","[HMR] Nothing hot updated.")}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=o(21),i=o(22),s=o(3),a=o(12),d=o(0),c=o(46),u=o(13),l=o(1);(function(){return n(this,void 0,void 0,(function*(){try{const t=yield r.NestFactory.create(i.AppModule,{}),{isConnected:o}=d.getConnection("default");o?s.Logger.log("Database connected","TypeORM",!1):s.Logger.error("Connect to database error","","TypeORM",!1),t.use(c()),t.enableShutdownHooks(),t.useGlobalInterceptors(new a.LoggingInterceptor);yield t.listen(l.PORT);e.hot.accept(),e.hot.dispose(()=>t.close()),"production"!==l.NODE_ENV?s.Logger.log(`🚀  Server ready at http://${l.DOMAIN}:${u.hex(l.PRIMARY_COLOR).bold(""+l.PORT)}/${l.END_POINT}`,"Bootstrap",!1):s.Logger.log("🚀  Server is listening on port "+u.hex(l.PRIMARY_COLOR).bold(""+l.PORT),"Bootstrap",!1),"production"!==l.NODE_ENV&&s.Logger.log(`🚀  Subscriptions ready at ws://${l.DOMAIN}:${u.hex(l.PRIMARY_COLOR).bold(""+l.PORT)}/${l.END_POINT}`,"Bootstrap",!1)}catch(e){s.Logger.error("❌  Error starting server, "+e,"","Bootstrap",!1),process.exit()}}))})().catch(e=>{throw s.Logger.error("❌  Error starting server, "+e,"","Bootstrap",!1),e})},function(e,t){e.exports=require("@nestjs/core")},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(3),i=o(4),s=o(23),a=o(0),d=o(1),c=o(12),u=o(41),l=o(45);let p=class{};p=n([r.Module({imports:[i.GraphQLModule.forRootAsync({useClass:c.GraphqlService}),r.CacheModule.registerAsync({useClass:c.CacheService}),s.TypeOrmModule.forRoot({type:"mongodb",database:"BlogDB",url:d.MLAB_URL,entities:a.getMetadataArgsStorage().tables.map(e=>e.target),synchronize:!0,useNewUrlParser:!0,useUnifiedTopology:!0,keepConnectionAlive:!0})],controllers:[],providers:[...Object.values(u),...Object.values(l)]})],p),t.AppModule=p},function(e,t){e.exports=require("@nestjs/typeorm")},function(e,t){e.exports=require("dotenv")},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(3),i=o(26),s=o(13),a=o(1);t.MyLogger=class{log(e){}error(e,t){}warn(e){}debug(e){}verbose(e){}};let d=class{intercept(e,t){if(e.getArgs()[3]){const o=e.getArgs()[3].parentType,n=s.hex(a.PRIMARY_COLOR).bold(""+e.getArgs()[3].fieldName);return t.handle().pipe(i.tap(()=>{r.Logger.debug(`⛩  ${o} » ${n}`,"GraphQL")}))}{const o=s.hex(a.PRIMARY_COLOR).bold(""+e.getArgs()[0].route.path),n=s.hex(a.PRIMARY_COLOR).bold(""+e.getArgs()[0].route.stack[0].method);return t.handle().pipe(i.tap(()=>{r.Logger.debug(`⛩  ${o} » ${n}`,"GraphQL")}))}}};d=n([r.Injectable()],d),t.LoggingInterceptor=d},function(e,t){e.exports=require("rxjs/operators")},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(3),s=o(28),a=o(0),d=o(29),c=o(2),u=o(34),l=o(37),p=o(1),f=new s.PubSub;let y=class{createGqlOptions(){return r(this,void 0,void 0,(function*(){return{typePaths:["./**/*.graphql"],playground:!0,schemaDirectives:u.default,formatError:e=>({message:e.message,code:e.extensions&&e.extensions.code,locations:e.locations,path:e.path}),tracing:!0,persistedQueries:{cache:new d.MemcachedCache(["memcached-server-1","memcached-server-2","memcached-server-3"],{retries:10,retry:1e4})},onHealthCheck:()=>new Promise((e,t)=>{e()}),formatResponse:e=>e,path:"/"+p.END_POINT,bodyParserConfig:{limit:"50mb"},uploads:{maxFieldSize:2,maxFileSize:20,maxFiles:5},installSubscriptionHandlers:!0,context:({req:e,res:t,connection:o})=>r(this,void 0,void 0,(function*(){if(o){const{currentUser:e}=o.context;return{pubsub:f,currentUser:e}}let n;const r=e.headers[p.ACCESS_TOKEN]||"";return r&&(n=yield l.verifyToken(r)),{req:e,res:t,pubsub:f,currentUser:n}})),subscriptions:{path:"/"+p.END_POINT,keepAlive:1e3,onConnect:(e,t,o)=>r(this,void 0,void 0,(function*(){let t;i.Logger.debug("🔗  Connected to websocket","GraphQL");const o=e[p.ACCESS_TOKEN]||"";return!!o&&(t=yield l.verifyToken(o),yield a.getMongoRepository(c.UserEntity).updateOne({_id:t._id},{$set:{isOnline:!0}},{upsert:!0}),{currentUser:t})})),onDisconnect:(e,t)=>r(this,void 0,void 0,(function*(){i.Logger.error("❌  Disconnected to websocket","","GraphQL",!1);const{initPromise:e}=t,{currentUser:o}=(yield e)||[];o&&(yield a.getMongoRepository(c.UserEntity).updateOne({_id:o._id},{$set:{isOnline:!1}},{upsert:!0}))}))}}}))}};y=n([i.Injectable()],y),t.GraphqlService=y},function(e,t){e.exports=require("graphql-subscriptions")},function(e,t){e.exports=require("apollo-server-cache-memcached")},function(e,t,o){"use strict";var n,r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=o(0),d=o(6),c=o(31),u=o(7);o(8);let l=n=class{constructor(e){e&&(Object.assign(this,u.plainToClass(n,e,{excludeExtraneousValues:!0})),this._id=this._id||d.v1(),this.isOnline=void 0!==this.isOnline&&this.isOnline,this.createdAt=this.createdAt||+new Date,this.avatar="https://i.stack.imgur.com/l60Hf.png")}hashPassword(){return s(this,void 0,void 0,(function*(){this.password=yield c.hash(this.password,10)}))}matchesPassword(e){return s(this,void 0,void 0,(function*(){return yield c.compare(e,this.password)}))}};r([u.Expose(),a.ObjectIdColumn(),i("design:type",String)],l.prototype,"_id",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"fullName",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"username",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"email",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"password",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"role",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"avatar",void 0),r([u.Expose(),a.Column(),i("design:type",Number)],l.prototype,"dayOfBirth",void 0),r([u.Expose(),a.Column(),i("design:type",String)],l.prototype,"gender",void 0),r([u.Expose(),a.Column(),i("design:type",Boolean)],l.prototype,"isOnline",void 0),r([u.Expose(),a.Column(),i("design:type",Number)],l.prototype,"createdAt",void 0),r([a.BeforeInsert(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],l.prototype,"hashPassword",null),l=n=r([a.Entity({name:"users"}),i("design:paramtypes",[Object])],l),t.UserEntity=l},function(e,t){e.exports=require("bcrypt")},function(e,t,o){"use strict";var n,r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const s=o(0),a=o(6),d=o(7);let c=n=class{constructor(e){e&&(Object.assign(this,d.plainToClass(n,e,{excludeExtraneousValues:!0})),this._id=this._id||a.v1(),this.idComments=[],this.idLikes=[],this.createdAt=this.createdAt||+new Date)}};r([d.Expose(),s.ObjectIdColumn(),i("design:type",String)],c.prototype,"_id",void 0),r([d.Expose(),s.Column(),i("design:type",String)],c.prototype,"idCreator",void 0),r([d.Expose(),s.Column(),i("design:type",String)],c.prototype,"description",void 0),r([d.Expose(),s.Column(),i("design:type",String)],c.prototype,"thumbnails",void 0),r([d.Expose(),s.Column(),i("design:type",Array)],c.prototype,"idLikes",void 0),r([d.Expose(),s.Column(),i("design:type",Array)],c.prototype,"idComments",void 0),r([d.Expose(),s.Column(),i("design:type",Number)],c.prototype,"createdAt",void 0),c=n=r([s.Entity({name:"posts"}),i("design:paramtypes",[Object])],c),t.PostEntity=c},function(e,t,o){"use strict";var n,r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const s=o(0),a=o(6),d=o(7);let c=n=class{constructor(e){e&&(Object.assign(this,d.plainToClass(n,e,{excludeExtraneousValues:!0})),this._id=this._id||a.v1(),this.idLikes=[],this.createdAt=this.createdAt||+new Date)}};r([d.Expose(),s.ObjectIdColumn(),i("design:type",String)],c.prototype,"_id",void 0),r([d.Expose(),s.Column(),i("design:type",String)],c.prototype,"idCreator",void 0),r([d.Expose(),s.Column(),i("design:type",String)],c.prototype,"description",void 0),r([d.Expose(),s.Column(),i("design:type",Array)],c.prototype,"idLikes",void 0),r([d.Expose(),s.Column(),i("design:type",Number)],c.prototype,"createdAt",void 0),c=n=r([s.Entity({name:"comments"}),i("design:paramtypes",[Object])],c),t.CommentEntity=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(35),r=o(36);t.default={isAuthenticated:n.default,checkRoles:r.default}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(9),r=o(14);class i extends n.SchemaDirectiveVisitor{visitFieldDefinition(e){const{resolve:t=r.defaultFieldResolver}=e;e.resolve=function(...e){const{currentUser:o}=e[2];if(!o)throw new n.AuthenticationError("Authentication token is invalid, please try again.");return t.apply(this,e)}}}t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(9),r=o(14);class i extends n.SchemaDirectiveVisitor{visitFieldDefinition(e){const{resolve:t=r.defaultFieldResolver}=e,{roles:o}=this.args;e.resolve=function(...e){const{currentUser:r}=e[2];if(!r)throw new n.AuthenticationError("You don`t have permission");const{role:i}=r;if(-1===o.indexOf(i))throw new n.AuthenticationError("You don`t have permission");return t.apply(this,e)}}}t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(15))},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);r.MLAB_URL;t.TypeOrmService={database:"Blog",url:r.MLAB_URL,entities:n.getMetadataArgsStorage().tables.map(e=>e.target),synchronize:!0,useNewUrlParser:!0,useUnifiedTopology:!0}},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(3);let i=class{createCacheOptions(){return{ttl:5,max:10}}};i=n([r.Injectable()],i),t.CacheService=i},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),n(o(42)),n(o(43)),n(o(44))},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,n){t(o,n,e)}},s=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=o(5),d=o(15),c=o(8),u=o(4),l=o(0),p=o(10),f=o(2);let y=class{constructor(e){this.dashboardService=e}hello(){return s(this,void 0,void 0,(function*(){return"hello world\t"}))}getUsers(){return s(this,void 0,void 0,(function*(){try{return yield l.getMongoRepository(f.UserEntity).find({})}catch(e){throw new p.ApolloError(e)}}))}getCurrentUser(e){return s(this,void 0,void 0,(function*(){return e}))}createUser(e,t,o){return s(this,void 0,void 0,(function*(){try{const{username:n,role:r,gender:i}=e;if("MEMBER"!==r&&(!o||"SUPERADMIN"!==o.role))throw new p.ApolloError("You dont have permission","403");if(yield l.getMongoRepository(f.UserEntity).findOne({username:n}))throw new p.ApolloError("Username has already existed");const s=yield l.getMongoRepository(f.UserEntity).save(new f.UserEntity(Object.assign(Object.assign({},e),{role:c.Role[r],gender:c.Gender[i]})));return yield this.dashboardService.dashboardUpdated(t),s}catch(e){throw new p.ApolloError(e)}}))}login(e){return s(this,void 0,void 0,(function*(){try{const{username:t,password:o}=e,n=yield l.getMongoRepository(f.UserEntity).findOne({username:t});if(!n||!(yield n.matchesPassword(o)))throw new p.ApolloError("Incorrect username or password");return{token:yield d.generateToken(n)}}catch(e){throw new p.ApolloError(e)}}))}updateUser(e,t){return s(this,void 0,void 0,(function*(){try{const{_id:o}=e;return yield l.getMongoRepository(f.UserEntity).updateOne({_id:o},{$set:Object.assign({},t)}),yield l.getMongoRepository(f.UserEntity).findOne({_id:o})}catch(e){throw new p.ApolloError(e)}}))}};n([u.Query(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],y.prototype,"hello",null),n([u.Query(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],y.prototype,"getUsers",null),n([u.Query(),i(0,u.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[f.UserEntity]),r("design:returntype",Promise)],y.prototype,"getCurrentUser",null),n([u.Mutation(),i(0,u.Args("input")),i(1,u.Context("pubsub")),i(2,u.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[c.CreateUserInput,Object,f.UserEntity]),r("design:returntype",Promise)],y.prototype,"createUser",null),n([u.Mutation(),i(0,u.Args("input")),r("design:type",Function),r("design:paramtypes",[c.LoginRequest]),r("design:returntype",Promise)],y.prototype,"login",null),n([u.Mutation(),i(0,u.Context("currentUser")),i(1,u.Args("input")),r("design:type",Function),r("design:paramtypes",[f.UserEntity,c.UpdateUserInput]),r("design:returntype",Promise)],y.prototype,"updateUser",null),y=n([u.Resolver("User"),r("design:paramtypes",[a.DashboardService])],y),t.UserResolver=y},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,n){t(o,n,e)}},s=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=o(0),d=o(4),c=o(9),u=o(2),l=o(5),p=o(16);let f=class{constructor(e){this.dashboardService=e}dashboardUpdate(e){if(!e)throw new c.ApolloError("Error pubsub");return e.asyncIterator("dashboardUpdated")}dashboardData(){return s(this,void 0,void 0,(function*(){const e=yield a.getMongoRepository(u.UserEntity).find({}),t=yield a.getMongoRepository(u.PostEntity).find({}),o={};e.map(e=>{o[e._id]=e});const n=t.reduce((e,t)=>(e[t.idCreator]?e[t.idCreator]++:e[t.idCreator]=1,e),{});let r,i=0;Object.keys(n).forEach(e=>{n[e]>=i&&(r=e),i=n[e]});const s=t.length>0?null==t?void 0:t.sort((e,t)=>(null==t?void 0:t.idLikes.length)-(null==e?void 0:e.idLikes.length))[0]:{},d=[p().startOf("days").valueOf(),p().valueOf()],c=[p().subtract(1,"days").startOf("days").valueOf(),p().subtract(1,"days").endOf("days").valueOf()],l=[p().subtract(2,"days").startOf("days").valueOf(),p().subtract(2,"days").endOf("days").valueOf()],f=[p().subtract(3,"days").startOf("days").valueOf(),p().subtract(3,"days").endOf("days").valueOf()],y=[p().subtract(4,"days").startOf("days").valueOf(),p().subtract(4,"days").endOf("days").valueOf()],h=[p().subtract(5,"days").startOf("days").valueOf(),p().subtract(5,"days").endOf("days").valueOf()],g=[p().subtract(6,"days").startOf("days").valueOf(),p().subtract(6,"days").endOf("days").valueOf()],v=[0,0,0,0,0,0,0];return t.map(e=>{e.createdAt>=d[0]&&e.createdAt<=d[1]&&v[0]++,e.createdAt>=c[0]&&e.createdAt<=c[1]&&v[1]++,e.createdAt>=l[0]&&e.createdAt<=l[1]&&v[2]++,e.createdAt>=f[0]&&e.createdAt<=f[1]&&v[3]++,e.createdAt>=y[0]&&e.createdAt<=y[1]&&v[4]++,e.createdAt>=h[0]&&e.createdAt<=h[1]&&v[5]++,e.createdAt>=g[0]&&e.createdAt<=g[1]&&v[6]++}),{numberOfUsers:e.length,numberOfPosts:t.length,topUser:o[r],topPost:s,postsInWeek:v}}))}deleteAllMember(e){return s(this,void 0,void 0,(function*(){try{const t=yield a.getMongoRepository(u.UserEntity).deleteMany({role:"MEMBER"});return yield this.dashboardService.dashboardUpdated(e),t.deletedCount>0}catch(e){throw new c.ApolloError(e)}}))}deleteAllAdmin(e){return s(this,void 0,void 0,(function*(){try{const t=yield a.getMongoRepository(u.UserEntity).deleteMany({role:"ADMIN"});return yield this.dashboardService.dashboardUpdated(e),t.deletedCount>0}catch(e){throw new c.ApolloError(e)}}))}};n([d.Subscription("dashboardUpdated",{filter:()=>!0}),i(0,d.Context("pubsub")),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],f.prototype,"dashboardUpdate",null),n([d.Query(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],f.prototype,"dashboardData",null),n([d.Mutation(),i(0,d.Context("pubsub")),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],f.prototype,"deleteAllMember",null),n([d.Mutation(),i(0,d.Context("pubsub")),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],f.prototype,"deleteAllAdmin",null),f=n([d.Resolver(),r("design:paramtypes",[l.DashboardService])],f),t.DashboardResolver=f},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,n){t(o,n,e)}},s=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=o(5),d=o(8),c=o(4),u=o(0),l=o(10),p=o(2);let f=class{constructor(e){this.dashboardService=e}getPosts(){return s(this,void 0,void 0,(function*(){try{const e=yield u.getMongoRepository(p.PostEntity).find({}),t=[],o=[];e.map(e=>{t.push(e.idCreator),e.idComments.map(e=>{o.push(e)})});const[n,r]=yield Promise.all([new Promise(e=>s(this,void 0,void 0,(function*(){const o={};(yield u.getMongoRepository(p.UserEntity).find({where:{_id:{$in:t}}})).map(e=>o[e._id]=e),e(o)}))),new Promise(e=>s(this,void 0,void 0,(function*(){const t={};(yield u.getMongoRepository(p.CommentEntity).find({where:{_id:{$in:o}}})).map(e=>t[e._id]=e),e(t)})))]);return e.map(e=>{const t=[];return e.idComments.map(e=>{t.push(r[e])}),Object.assign(Object.assign({},e),{comments:t,creator:n[e.idCreator]})})}catch(e){throw new l.ApolloError(e)}}))}createNewPost(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.PostEntity).save(new p.PostEntity(Object.assign(Object.assign({},o),{idCreator:t._id,createdAt:+new Date})));return yield this.dashboardService.dashboardUpdated(e),n}catch(e){throw new l.ApolloError(e)}}))}deleteAllPost(e){return s(this,void 0,void 0,(function*(){try{const t=yield u.getMongoRepository(p.PostEntity).deleteMany({});return yield u.getMongoRepository(p.CommentEntity).deleteMany({}),yield this.dashboardService.dashboardUpdated(e),t.deletedCount>0}catch(e){throw new l.ApolloError(e)}}))}deletePost(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.PostEntity).findOne({_id:t});if(!n)throw new l.ApolloError("Not found: Post","404");if(n.idCreator!==o._id)throw new l.ApolloError("Cant delete post","403");const{idComments:r}=n;yield u.getMongoRepository(p.CommentEntity).deleteMany({_id:{$in:r}});const i=yield u.getMongoRepository(p.PostEntity).deleteOne({_id:t});return yield this.dashboardService.dashboardUpdated(e),i.deletedCount>0}catch(e){throw new l.ApolloError(e)}}))}updatePost(e,t,o){return s(this,void 0,void 0,(function*(){try{const{_id:n}=e,r=yield u.getMongoRepository(p.PostEntity).findOne({_id:o});if(!r)throw new l.ApolloError("Not found: Post","404");if(r.idCreator!==e._id)throw new l.ApolloError("Cant update post","403");return yield u.getMongoRepository(p.PostEntity).updateOne({_id:o},{$set:Object.assign({},t)}),yield u.getMongoRepository(p.PostEntity).findOne({_id:o})}catch(e){throw new l.ApolloError(e)}}))}toggleLikePost(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.PostEntity).findOne({_id:t});if(!n)throw new l.ApolloError("Not found: Post","409");let{idLikes:r}=n;return-1===r.indexOf(e._id)?(r.push(e._id),yield u.getMongoRepository(p.PostEntity).updateOne({_id:t},{$set:{idLikes:r}}),yield this.dashboardService.dashboardUpdated(o),!0):(r.splice(r.indexOf(e._id),1),yield u.getMongoRepository(p.PostEntity).updateOne({_id:t},{$set:{idLikes:r}}),yield this.dashboardService.dashboardUpdated(o),!1)}catch(e){throw new l.ApolloError(e)}}))}commentOnPost(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.PostEntity).findOne({_id:t});if(!n)throw new l.ApolloError("Not fount: Post","404");const r=yield u.getMongoRepository(p.CommentEntity).save(new p.CommentEntity(Object.assign(Object.assign({},o),{idCreator:e._id}))),{idComments:i}=n;return i.push(r._id),yield u.getMongoRepository(p.PostEntity).updateOne({_id:t},{$set:{idComments:i}}),r}catch(e){throw new l.ApolloError(e)}}))}deleteComment(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.PostEntity).findOne({_id:e}),r=yield u.getMongoRepository(p.CommentEntity).findOne({_id:t});if(!n)throw new l.ApolloError("Not found: Post","404");if(!r)throw new l.ApolloError("Not found: Comment","404");if(r.idCreator!==o._id)throw new l.ApolloError("Cant delete comment","403");const{idComments:i}=n;return i.splice(i.indexOf(r._id),1),yield u.getMongoRepository(p.PostEntity).updateOne({_id:e},{$set:{idComments:i}}),(yield u.getMongoRepository(p.CommentEntity).deleteOne({_id:t})).deletedCount>0}catch(e){throw new l.ApolloError(e)}}))}updateComment(e,t,o){return s(this,void 0,void 0,(function*(){try{const n=yield u.getMongoRepository(p.CommentEntity).findOne({_id:e});if(!n)throw new l.ApolloError("Not found: Comment","404");if(n.idCreator!==o._id)throw new l.ApolloError("Cant update comment","403");return yield u.getMongoRepository(p.CommentEntity).updateOne({_id:e},{$set:Object.assign({},t)}),yield u.getMongoRepository(p.CommentEntity).findOne({_id:e})}catch(e){throw new l.ApolloError(e)}}))}toggleLikeComment(e,t){return s(this,void 0,void 0,(function*(){try{const o=yield u.getMongoRepository(p.CommentEntity).findOne({_id:e});if(!o)throw new l.ApolloError("Not found: Comment","409");let{idLikes:n}=o;return-1===n.indexOf(t._id)?(n.push(t._id),yield u.getMongoRepository(p.CommentEntity).updateOne({_id:e},{$set:{idLikes:n}}),!0):(n.splice(n.indexOf(t._id),1),yield u.getMongoRepository(p.CommentEntity).updateOne({_id:e},{$set:{idLikes:n}}),!1)}catch(e){throw new l.ApolloError(e)}}))}};n([c.Query(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],f.prototype,"getPosts",null),n([c.Mutation(),i(0,c.Context("pubsub")),i(1,c.Context("currentUser")),i(2,c.Args("input")),r("design:type",Function),r("design:paramtypes",[Object,p.UserEntity,d.PostInput]),r("design:returntype",Promise)],f.prototype,"createNewPost",null),n([c.Mutation(),i(0,c.Context("pubsub")),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],f.prototype,"deleteAllPost",null),n([c.Mutation(),i(0,c.Context("pubsub")),i(1,c.Args("idPost")),i(2,c.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[Object,Object,p.UserEntity]),r("design:returntype",Promise)],f.prototype,"deletePost",null),n([c.Mutation(),i(0,c.Context("currentUser")),i(1,c.Args("input")),i(2,c.Args("idPost")),r("design:type",Function),r("design:paramtypes",[p.UserEntity,d.PostInput,String]),r("design:returntype",Promise)],f.prototype,"updatePost",null),n([c.Mutation(),i(0,c.Context("currentUser")),i(1,c.Args("idPost")),i(2,c.Context("pubsub")),r("design:type",Function),r("design:paramtypes",[p.UserEntity,String,Object]),r("design:returntype",Promise)],f.prototype,"toggleLikePost",null),n([c.Mutation(),i(0,c.Context("currentUser")),i(1,c.Args("idPost")),i(2,c.Args("input")),r("design:type",Function),r("design:paramtypes",[p.UserEntity,String,d.CommentInput]),r("design:returntype",Promise)],f.prototype,"commentOnPost",null),n([c.Mutation(),i(0,c.Args("idPost")),i(1,c.Args("idComment")),i(2,c.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[String,String,p.UserEntity]),r("design:returntype",Promise)],f.prototype,"deleteComment",null),n([c.Mutation(),i(0,c.Args("idComment")),i(1,c.Args("input")),i(2,c.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[String,d.CommentInput,p.UserEntity]),r("design:returntype",Promise)],f.prototype,"updateComment",null),n([c.Mutation(),i(0,c.Args("idComment")),i(1,c.Context("currentUser")),r("design:type",Function),r("design:paramtypes",[String,p.UserEntity]),r("design:returntype",Promise)],f.prototype,"toggleLikeComment",null),f=n([c.Resolver(),r("design:paramtypes",[a.DashboardService])],f),t.PostResolver=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(5))},function(e,t){e.exports=require("helmet")}]);